# Work Packages: 2.x Sync & Auth Documentation

**Inputs**: Design documents from `/kitty-specs/030-2x-sync-auth-docs/`
**Prerequisites**: plan.md (required), spec.md (user stories), research.md

**Tests**: Not applicable â€” documentation mission. Validation is via `docfx build` zero-warning check.

**Organization**: Fine-grained subtasks (`Txxx`) roll up into work packages (`WPxx`). Each work package produces one or more documentation pages that are independently reviewable.

**Prompt Files**: Each work package references a matching prompt file in `/tasks/` generated by `/spec-kitty.tasks`.

## Subtask Format: `[Txxx] [P?] Description`
- **[P]** indicates the subtask can proceed in parallel (different files/pages).

---

## Work Package WP01: Auth & Sync CLI Reference (Priority: P1)

**Goal**: Add reference entries for all `auth` and new `sync` subcommands to `docs/reference/cli-commands.md`.
**Independent Test**: Every `auth` and `sync` subcommand has a reference entry with flags, arguments, behavior, and examples.
**Prompt**: `/tasks/WP01-auth-sync-cli-reference.md`
**Estimated Size**: ~350 lines

### Included Subtasks
- [x] T001 Add `spec-kitty auth` command group header and description
- [x] T002 Add `spec-kitty auth login` reference (flags: `--username/-u`, `--password/-p`, `--force/-f`)
- [x] T003 Add `spec-kitty auth logout` reference
- [x] T004 Add `spec-kitty auth status` reference (token expiry display)
- [x] T005 Add `spec-kitty sync status` reference (flags: `--check/-c`)
- [x] T006 Add `spec-kitty sync now` reference (inferred flags: `--verbose/-v`, `--dry-run/-n`)

### Implementation Notes
- Follow the exact format used by existing CLI reference entries in `cli-commands.md` (Synopsis, Description, Options table, Examples)
- Source: `git show fc0597de:src/specify_cli/cli/commands/auth.py` for auth commands
- Source: `git show 90dc9edd~1:src/specify_cli/cli/commands/sync.py` for sync status
- `sync now` interface is inferred from `batch.py` â€” mark with a note that this is preliminary

### Parallel Opportunities
- [P] Can run in parallel with WP02, WP03, WP06

### Dependencies
- None (starting package).

### Risks & Mitigations
- `sync now` flags are inferred, not from actual implementation â†’ note in doc that interface is provisional

---

## Work Package WP02: Server Configuration Reference (Priority: P1)

**Goal**: Add server URL and credential storage reference sections to `docs/reference/configuration.md`.
**Independent Test**: A developer can find server configuration and credential file format in the reference docs.
**Prompt**: `/tasks/WP02-server-config-reference.md`
**Estimated Size**: ~250 lines

### Included Subtasks
- [x] T007 Add server URL configuration section (`~/.spec-kitty/config.toml` format, fields, defaults)
- [x] T008 Add credential storage section (`~/.spec-kitty/credentials.json` format, token types, expiry)
- [x] T009 Add WebSocket token section (ephemeral token, exchange flow, not user-managed)
- [x] T010 Update See Also links in configuration.md to reference new auth/sync docs

### Implementation Notes
- Insert new sections after the existing "VCS Configuration" section in configuration.md
- Follow the existing pattern: heading, description, Location, Fields table, code example
- Credential file is created by `auth login`, not user-edited â€” document as read-only reference

### Parallel Opportunities
- [P] Can run in parallel with WP01, WP03, WP06

### Dependencies
- None (independent reference page).

### Risks & Mitigations
- Credential file format may change â†’ document based on current `sync/auth.py` CredentialStore

---

## Work Package WP03: Sync Architecture Explanation (Priority: P2)

**Goal**: Create `docs/explanations/sync-architecture.md` explaining the event-sourced sync model and three data paths.
**Independent Test**: A developer can describe the three sync paths and the event model after reading this page.
**Prompt**: `/tasks/WP03-sync-architecture-explanation.md`
**Estimated Size**: ~400 lines

### Included Subtasks
- [x] T011 Create `docs/explanations/` directory and `toc.yml`
- [x] T012 Write introduction: why event sourcing, what problems it solves for distributed dev tools
- [x] T013 Write event model section: event_id, event_type, aggregate, lamport_clock, node_id, payload
- [x] T014 Write WebSocket real-time sync path: connection lifecycle, heartbeat, team isolation
- [x] T015 Write offline queue + batch sync path: SQLite queue, `sync now`, gzip batch upload
- [x] T016 Write authentication flow section: JWT lifecycle, token refresh, WS token exchange

### Implementation Notes
- This is the conceptual foundation â€” explain *why* and *how*, not step-by-step instructions
- Include an ASCII diagram showing the three data paths between CLI and server
- Reference the spec-kitty-events library for Lamport clocks and CRDT merge rules (without exposing internals)
- Follow Divio explanation style: understanding-oriented, no step-by-step commands

### Parallel Opportunities
- [P] Can run in parallel with WP01, WP02, WP06

### Dependencies
- None (independent explanation page).

### Risks & Mitigations
- Architecture may evolve â€” keep explanations at conceptual level, avoid implementation details

---

## Work Package WP04: Authentication How-To (Priority: P1)

**Goal**: Create `docs/how-to/authenticate.md` covering login, status, logout workflows.
**Independent Test**: A developer can follow the how-to to log in, check status, and log out from the CLI.
**Prompt**: `/tasks/WP04-authentication-howto.md`
**Estimated Size**: ~300 lines

### Included Subtasks
- [x] T017 Write prerequisites section (spec-kitty 2.x installed, server URL configured, valid credentials)
- [x] T018 Write login procedure (`auth login`, interactive prompts, `--force` re-auth)
- [x] T019 Write status check section (`auth status`, interpreting token expiry output)
- [x] T020 Write logout procedure (`auth logout`, credential cleanup)
- [x] T021 Write troubleshooting section (invalid credentials, server unreachable, expired tokens, permission errors)
- [x] T022 Write See Also links (reference/cli-commands, reference/configuration, tutorial/server-connection)

### Implementation Notes
- Follow existing how-to style (see `install-spec-kitty.md`): problem statement, prerequisites, steps, troubleshooting, See Also
- Link to WP01 reference entries for detailed flag documentation
- Include actual CLI output examples based on the deleted `auth.py` source

### Parallel Opportunities
- T017-T022 are sections of one file; must be written sequentially within the WP

### Dependencies
- Depends on WP01 (links to auth CLI reference entries).

### Risks & Mitigations
- CLI output may change when commands are restored â†’ use representative output from deleted source

---

## Work Package WP05: Server Sync How-To (Priority: P1)

**Goal**: Create `docs/how-to/sync-to-server.md` covering sync now, sync status, and workspace registration.
**Independent Test**: A developer can follow the how-to to push queued events and check sync status.
**Prompt**: `/tasks/WP05-server-sync-howto.md`
**Estimated Size**: ~350 lines

### Included Subtasks
- [x] T023 Write introduction: distinguish server sync from local workspace sync (`sync-workspaces.md`)
- [x] T024 Write batch sync procedure (`sync now`, what gets pushed/pulled, expected output)
- [x] T025 Write sync status procedure (`sync status`, `--check` for connectivity test)
- [x] T026 Write offline workflow section (working offline, queue accumulation, reconnection)
- [x] T027 Write troubleshooting section (server unreachable, auth expired, queue errors, partial sync)
- [x] T028 Write See Also links (reference/cli-commands, how-to/authenticate, explanations/sync-architecture)

### Implementation Notes
- **CRITICAL**: First section must explicitly distinguish this from `docs/how-to/sync-workspaces.md` (local worktree rebase)
- FR-011 requires clear separation between local and server sync
- Include a callout box explaining when to use `sync workspace` (local) vs `sync now` (server)

### Parallel Opportunities
- T023-T028 are sections of one file; must be written sequentially within the WP

### Dependencies
- Depends on WP01 (links to sync CLI reference entries).

### Risks & Mitigations
- `sync now` interface is inferred â†’ mark examples as provisional, link to reference for current flags

---

## Work Package WP06: SaaS Dashboard How-To (Priority: P2)

**Goal**: Create `docs/how-to/use-saas-dashboard.md` covering the overview, board, and activity views.
**Independent Test**: A user can navigate to all three dashboard views and understand what each displays.
**Prompt**: `/tasks/WP06-saas-dashboard-howto.md`
**Estimated Size**: ~300 lines

### Included Subtasks
- [x] T029 Write introduction: what the dashboard is, how to access it (URL pattern)
- [x] T030 Write overview view section (project/feature/WP counts, status breakdown, recent events)
- [x] T031 Write board view section (kanban columns, status filters, project/feature filters)
- [x] T032 Write activity view section (event feed, pagination, HTMX infinite scroll)
- [x] T033 Write See Also links (how-to/authenticate, explanations/sync-architecture)

### Implementation Notes
- Dashboard is accessed via browser, not CLI â€” document the URL pattern `/a/<team>/dashboards/`
- Reference the SaaS deployment at `spec-kitty-dev.fly.dev` as an example (use placeholder `your-server.example.com`)
- Describe what each view shows without screenshots (documentation only, no images in scope)

### Parallel Opportunities
- [P] Can run in parallel with WP01, WP02, WP03

### Dependencies
- None (dashboard has no CLI reference dependencies).

### Risks & Mitigations
- Dashboard UI may change â†’ keep descriptions at feature level, not pixel-level

---

## Work Package WP07: Server Connection Tutorial (Priority: P1) ðŸŽ¯ MVP

**Goal**: Create `docs/tutorials/server-connection.md` â€” end-to-end guide from zero to first sync.
**Independent Test**: A new 2.x user can follow the tutorial start-to-finish and have a working sync connection.
**Prompt**: `/tasks/WP07-server-connection-tutorial.md`
**Estimated Size**: ~350 lines

### Included Subtasks
- [x] T034 Write introduction: what you'll learn, time estimate, prerequisites
- [x] T035 Write step 1: configure server URL (`~/.spec-kitty/config.toml`)
- [x] T036 Write step 2: authenticate with `auth login`
- [x] T037 Write step 3: verify connection with `auth status` and `sync status --check`
- [x] T038 Write step 4: run first sync with `sync now`
- [x] T039 Write next steps section (links to how-to guides, dashboard, sync architecture)

### Implementation Notes
- Tutorial style: learning-oriented, step-by-step, show expected output at each step
- Must work as a standalone guide â€” a new user should NOT need to read other docs first
- Link to how-to and reference pages for deeper exploration after completing the tutorial
- Follow Divio tutorial principles: focused on learning, concrete steps, defined starting/ending states

### Parallel Opportunities
- T034-T039 are sections of one file; must be written sequentially within the WP

### Dependencies
- Depends on WP04, WP05 (links to authentication and sync how-to pages).

### Risks & Mitigations
- Tutorial becomes outdated if CLI interface changes â†’ keep steps high-level with links to reference for exact flags

---

## Work Package WP08: Integration & Cross-Linking (Priority: P2)

**Goal**: Update all `toc.yml` files, add cross-page links, validate build.
**Independent Test**: All new pages appear in navigation, all internal links resolve, docfx build passes.
**Prompt**: `/tasks/WP08-integration-cross-linking.md`
**Estimated Size**: ~250 lines

### Included Subtasks
- [x] T040 Update `docs/tutorials/toc.yml` with `server-connection.md` entry
- [x] T041 Update `docs/how-to/toc.yml` with `authenticate.md`, `sync-to-server.md`, `use-saas-dashboard.md`
- [x] T042 Create `docs/explanations/toc.yml` with `sync-architecture.md` entry
- [x] T043 Verify cross-page See Also links in all new and updated pages
- [x] T044 Verify all internal links resolve (no broken relative paths)
- [x] T045 Run `docfx build` and confirm zero warnings (if DocFX is available)

### Implementation Notes
- Follow existing toc.yml format from tutorials/toc.yml and how-to/toc.yml
- Explanations directory is new â€” create toc.yml from scratch using same format
- Check that the top-level `docs/toc.yml` already has an Explanations tab (it does per research)

### Parallel Opportunities
- T040, T041, T042 can proceed in parallel (different files)
- T043-T045 must follow after all pages are written

### Dependencies
- Depends on WP01, WP02, WP03, WP04, WP05, WP06, WP07 (all content must exist before integration).

### Risks & Mitigations
- DocFX may not be installed locally â†’ document build command, flag as optional validation

---

## Dependency & Execution Summary

- **Phase 1 (parallel)**: WP01, WP02, WP03, WP06 â€” no dependencies, can all run simultaneously
- **Phase 2 (after Phase 1)**: WP04 (needs WP01), WP05 (needs WP01)
- **Phase 3 (after Phase 2)**: WP07 (needs WP04, WP05)
- **Phase 4 (after all)**: WP08 (needs WP01-WP07)

**Parallelization**: 4 WPs can run simultaneously in Phase 1, giving maximum throughput.

**MVP Scope**: WP01 (reference) + WP04 (auth how-to) + WP07 (tutorial) â€” enables a developer to authenticate and start syncing with minimal documentation.

---

## Subtask Index (Reference)

| Subtask ID | Summary | Work Package | Priority | Parallel? |
|------------|---------|--------------|----------|-----------|
| T001 | Auth command group header | WP01 | P1 | Yes |
| T002 | auth login reference | WP01 | P1 | Yes |
| T003 | auth logout reference | WP01 | P1 | Yes |
| T004 | auth status reference | WP01 | P1 | Yes |
| T005 | sync status reference | WP01 | P1 | Yes |
| T006 | sync now reference | WP01 | P1 | Yes |
| T007 | Server URL config section | WP02 | P1 | Yes |
| T008 | Credential storage section | WP02 | P1 | Yes |
| T009 | WebSocket token section | WP02 | P1 | Yes |
| T010 | Update See Also links | WP02 | P1 | Yes |
| T011 | Create explanations/ dir | WP03 | P2 | Yes |
| T012 | Event sourcing intro | WP03 | P2 | Yes |
| T013 | Event model explanation | WP03 | P2 | Yes |
| T014 | WebSocket sync path | WP03 | P2 | Yes |
| T015 | Offline queue + batch path | WP03 | P2 | Yes |
| T016 | Authentication flow | WP03 | P2 | Yes |
| T017 | Auth how-to prerequisites | WP04 | P1 | No |
| T018 | Login procedure | WP04 | P1 | No |
| T019 | Status check section | WP04 | P1 | No |
| T020 | Logout procedure | WP04 | P1 | No |
| T021 | Auth troubleshooting | WP04 | P1 | No |
| T022 | Auth See Also links | WP04 | P1 | No |
| T023 | Server vs local sync intro | WP05 | P1 | No |
| T024 | Batch sync procedure | WP05 | P1 | No |
| T025 | Sync status procedure | WP05 | P1 | No |
| T026 | Offline workflow section | WP05 | P1 | No |
| T027 | Sync troubleshooting | WP05 | P1 | No |
| T028 | Sync See Also links | WP05 | P1 | No |
| T029 | Dashboard introduction | WP06 | P2 | Yes |
| T030 | Overview view section | WP06 | P2 | Yes |
| T031 | Board view section | WP06 | P2 | Yes |
| T032 | Activity view section | WP06 | P2 | Yes |
| T033 | Dashboard See Also links | WP06 | P2 | Yes |
| T034 | Tutorial introduction | WP07 | P1 | No |
| T035 | Step 1: configure server | WP07 | P1 | No |
| T036 | Step 2: authenticate | WP07 | P1 | No |
| T037 | Step 3: verify connection | WP07 | P1 | No |
| T038 | Step 4: first sync | WP07 | P1 | No |
| T039 | Next steps section | WP07 | P1 | No |
| T040 | Update tutorials/toc.yml | WP08 | P2 | Yes |
| T041 | Update how-to/toc.yml | WP08 | P2 | Yes |
| T042 | Create explanations/toc.yml | WP08 | P2 | Yes |
| T043 | Verify cross-page links | WP08 | P2 | No |
| T044 | Verify internal link paths | WP08 | P2 | No |
| T045 | Run docfx build validation | WP08 | P2 | No |
